import { FormEvent, useState } from "react";
import styles from "./home.module.css";
import { DateCalendar } from "@mui/x-date-pickers";
import dayjs, { Dayjs } from "dayjs";

interface PropsDisplay {
  nome: string;
  item: string;
  dataEntrega: String;
}

export function Home() {
  const [nome, setNome] = useState("");
  const [item, setItem] = useState("");
  const [display, setDisplay] = useState<PropsDisplay>();
  const [dataAmanha, setDataAmanha] = useState<Dayjs | null>(dayjs(buscarDataPosterior(new Date())));
  const [valorSelecionado, setValorSelecionado] = useState<Dayjs | null>();

  function tratarValorData(data: any) {
    return data.format("DD/MM/YYYY").toString();
  }

  function buscarDataPosterior(dataRecebida: Date) {
    dataRecebida.setHours(0);
    dataRecebida.setMinutes(0);
    dataRecebida.setSeconds(0);
    dataRecebida.setDate(dataRecebida.getDate() + 1);
    return dataRecebida;
  }

  function handleSubmit(event: FormEvent) {
    event.preventDefault();

    if (!nome || !item || !valorSelecionado) {
      alert("Informe o Campo!");
      return;
    }

    setDisplay({
      nome: nome,
      item: item,
      dataEntrega: tratarValorData(valorSelecionado),
    });
    setNome("");
    setItem("");
  }

  return (
    <div className={styles.container}>
      <main>
        <form onSubmit={handleSubmit} className={styles.form1}>
          <h1>Cadastrar Itens</h1>

          <input
            className={styles.input1}
            placeholder="Digite seu nome..."
            type="text"
            value={nome}
            onChange={(e) => setNome(e.target.value)}
          />
          <input
            className={styles.input1}
            placeholder="Item emprestado..."
            type="text"
            value={item}
            onChange={(e) => setItem(e.target.value)}
          />

          <label>INFORME A DATA DE DEVOLUÇÃO</label>

          <fieldset className={styles.borda}>
            <DateCalendar
              minDate={dataAmanha}
              onChange={(value) => setValorSelecionado(value)}
            />
          </fieldset>

          <button type="submit">Cadastrar</button>
        </form>

        {display && Object.keys(display).length > 0 && (
          <section>
            <div className={styles.display2}>
              <label>Nome: {display?.nome}</label>
              <label>Item: {display?.item}</label>
              <label>Data da Entrega: {display?.dataEntrega} </label>
            </div>
          </section>
        )}
      </main>
    </div>
  );
}
